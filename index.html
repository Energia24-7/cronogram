<!-- Añade Papa Parse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
  google.charts.load('current', {packages: ['gantt']});
  google.charts.setOnLoadCallback(drawChart);

  const CSV_URL =
    'https://docs.google.com/spreadsheets/d/2PACX-1vSXMsoaOAWVi_3187teWKGrIrmwwIOQGvHQtZrbHGAXwGTlTjVQkcOzWFV5ywUYbsh74PlIAawueM--/export?format=csv&gid=0';

  async function drawChart () {
    const resp = await fetch(CSV_URL);
    const csv = await resp.text();

    // 1️⃣ parseo robusto
    const rows = Papa.parse(csv, {header: true}).data;

    // 2️⃣ construyo DataTable
    const dt = new google.visualization.DataTable();
    dt.addColumn('string',  'Task ID');
    dt.addColumn('string',  'Task Name');
    dt.addColumn('string',  'Resource');
    dt.addColumn('date',    'Start Date');
    dt.addColumn('date',    'End Date');
    dt.addColumn('number',  'Duration');
    dt.addColumn('number',  'Percent Complete');
    dt.addColumn('string',  'Dependencies');

    rows.forEach(r => {
      if (!r['Task ID']) return;
      dt.addRow([
        r['Task ID'],
        r['Task Name'],
        r.Resource,
        new Date(r['Start Date']),
        new Date(r['End Date']),
        null,
        Number(r['Percent Complete'] || 0),
        r.Dependencies || null
      ]);
    });

    // 3️⃣ opciones: rejilla + estética
    const options = {
      height: 800,
      gantt: {
        trackHeight: 40,
        innerGridTrack:       {fill: '#ffffff'},
        innerGridDarkTrack:   {fill: '#e9e9e9'},
        innerGridMinorStroke: '#bdbdbd',
        innerGridMinorStrokeWidth: 1,
        innerGridMinorStrokeOpacity: 1
      }
    };

    new google.visualization.Gantt(
      document.getElementById('gantt_chart')
    ).draw(dt, options);
  }
</script>
